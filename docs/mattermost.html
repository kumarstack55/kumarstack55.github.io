<!doctype html>
<html class="no-js" lang="ja">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="検索" href="search.html" /><link rel="next" title="HTML" href="html.html" /><link rel="prev" title="GitLab" href="gitlab.html" />

    <meta name="generator" content="sphinx-4.2.0, furo 2021.10.09"/>
        <title>Mattermost - Untitled ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=0254c309f5cadf746f1a613e7677379ac9c8cdcd" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=16fb25fabf47304eee183a5e9af80b1ba98259b1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Untitled  ドキュメント</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Untitled  ドキュメント</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=検索 name="q" aria-label="検索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="vim.html">Vim</a></li>
<li class="toctree-l1"><a class="reference internal" href="vscode.html">Visual Studio Code - vscode</a></li>
<li class="toctree-l1"><a class="reference internal" href="ctags.html">Ctags</a></li>
<li class="toctree-l1"><a class="reference internal" href="excel.html">Excel</a></li>
<li class="toctree-l1"><a class="reference internal" href="powerpoint.html">PowerPoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="chrome_extension.html">Chrome拡張</a></li>
<li class="toctree-l1"><a class="reference internal" href="github.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="gitlab.html">GitLab</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Mattermost</a></li>
<li class="toctree-l1"><a class="reference internal" href="html.html">HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodejs.html">Node JS</a></li>
<li class="toctree-l1"><a class="reference internal" href="prometheus.html">Prometheus</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="mariadb.html">MariaDB</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="ssh.html">SSH</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="ssh_client.html">SSHクライアント</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="python.html">Python</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="python/foundation.html">Python基礎</a></li>
<li class="toctree-l2"><a class="reference internal" href="python/standard_library.html">Python3 の標準ライブラリ</a></li>
<li class="toctree-l2"><a class="reference internal" href="python/application.html">Python 応用</a></li>
<li class="toctree-l2"><a class="reference internal" href="python/jupyterlab.html">Jupyter Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="python/python2.html">Python2</a></li>
<li class="toctree-l2"><a class="reference internal" href="python/math.html">Python応用(数学)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="c.html">C言語</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="bats.html">Bats-core</a></li>
<li class="toctree-l1"><a class="reference internal" href="jq.html">jq</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="bash.html">Bash</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="bash/foundation.html">bash基礎</a></li>
<li class="toctree-l2"><a class="reference internal" href="bash/application.html">bash応用</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">コンテナ</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="kubernetes.html">Kubernetes</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="kubernetes_foundation.html">Kubernetes 基礎</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes_kubectl.html">kubectl</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes_minikube.html">Minikube</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="powershell.html">PowerShell</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="powershell/powershell7.html">PowerShell 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="powershell/foundation.html">PowerShell 基礎</a></li>
<li class="toctree-l2"><a class="reference internal" href="powershell/application.html">PowerShell 応用</a></li>
<li class="toctree-l2"><a class="reference internal" href="powershell/get_childitem.html">停止しても再実行できるように、ファイルの一覧を出力する。</a></li>
<li class="toctree-l2"><a class="reference internal" href="powershell/pester.html">Pester でテストする。</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="windows.html">Microsoft Windows</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="windows_foundation.html">Microsoft Windows 基礎</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows_wsl.html">WSL2</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="linux.html">Linux</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="linux_foundation.html">Linux 基礎</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_network.html">Linuxのネットワーク管理</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debian.html">Debian</a></li>
<li class="toctree-l1"><a class="reference internal" href="ubuntu.html">Ubuntu</a></li>
<li class="toctree-l1"><a class="reference internal" href="vagrant.html">Vagrant</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtualbox.html">VirtualBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="oci.html">Oracle Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="japanese_imperial_year.html">西暦、和暦</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="mattermost">
<h1>Mattermost<a class="headerlink" href="#mattermost" title="このヘッドラインへのパーマリンク">¶</a></h1>
<section id="id1">
<h2>Mattermost をインストールする。<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="p">-</span><span class="n">-name</span> <span class="n">mattermost-preview</span> <span class="n">-d</span> <span class="p">-</span><span class="n">-publish</span> <span class="n">8065</span><span class="p">:</span><span class="n">8065</span> <span class="n">mattermost</span><span class="p">/</span><span class="n">mattermost-preview</span>
</pre></div>
</div>
<p>参考資料:</p>
<ul class="simple">
<li><p>https://mattermost.com/deploy/</p></li>
</ul>
</section>
<section id="incoming-webhook">
<h2>Incoming Webhook<a class="headerlink" href="#incoming-webhook" title="このヘッドラインへのパーマリンク">¶</a></h2>
<section id="incoming-webhook-url">
<h3>Incoming Webhook の URL を作る。<a class="headerlink" href="#incoming-webhook-url" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p>Integrations</p>
<ul>
<li><p>Add Incoming Webhook</p>
<ul>
<li><p>Title: incoming-webhook1</p></li>
<li><p>Description:</p></li>
<li><p>Channel: channel1</p></li>
<li><p>[x] Lock to this channel</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id2">
<h3>指定チャネルに書く。<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># WSL2</span>

<span class="nv">incoming_webhook_url</span><span class="o">=</span><span class="s2">"http://localhost:8065/hooks/7uxs4k5rp3bkfnypmnztsdjdmc"</span>

curl -i -X POST --data-urlencode <span class="s1">'payload={"text": "Hello, this is some text\nThis is more text. :tada:"}'</span> <span class="s2">"</span><span class="nv">$incoming_webhook_url</span><span class="s2">"</span>
</pre></div>
</div>
<p>参考資料:</p>
<ul class="simple">
<li><p>https://docs.mattermost.com/developer/webhooks-incoming.html#incoming-webhooks</p></li>
</ul>
</section>
<section id="id3">
<h3>ユーザ名を指定して指定チャネルに書く。<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p>System Console</p>
<ul>
<li><p>Integrations</p>
<ul>
<li><p>Integration Management</p>
<ul>
<li><p>Enable integrations to override usernames</p>
<ul>
<li><p>(o) true</p></li>
</ul>
</li>
<li><p>Save</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># WSL2</span>

curl -i -X POST -H <span class="s1">'Content-Type: application/json'</span> -d <span class="s1">'</span>
<span class="s1">{</span>
<span class="s1">  "username": "test-automation",</span>
<span class="s1">  "icon_url": "https://mattermost.org/wp-content/uploads/2016/04/icon.png",</span>
<span class="s1">  "text": "#### Test results for July 27th, 2017\n&lt;!channel&gt; please review failed tests.\n</span>
<span class="s1">  | Component  | Tests Run   | Tests Failed                                   |</span>
<span class="s1">  |:-----------|:-----------:|:-----------------------------------------------|</span>
<span class="s1">  | Server     | 948         | :white_check_mark: 0                           |</span>
<span class="s1">  | Web Client | 123         | :warning: 2 [(see details)](http://linktologs) |</span>
<span class="s1">  | iOS Client | 78          | :warning: 3 [(see details)](http://linktologs) |</span>
<span class="s1">  "</span>
<span class="s1">  }</span>
<span class="s1">'</span> <span class="s2">"</span><span class="nv">$incoming_webhook_url</span><span class="s2">"</span>
</pre></div>
</div>
<ul class="simple">
<li><p>https://docs.mattermost.com/developer/webhooks-incoming.html</p></li>
</ul>
</section>
<section id="id4">
<h3>アタッチメントを書く。<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># WSL2</span>

curl -i -X POST -H <span class="s1">'Content-Type: application/json'</span> -d <span class="s1">'</span>
<span class="s1">  {</span>
<span class="s1">    "attachments": [</span>
<span class="s1">      {</span>
<span class="s1">        "fallback": "test",</span>
<span class="s1">        "color": "#FF8000",</span>
<span class="s1">        "pretext": "This is optional pretext that shows above the attachment.",</span>
<span class="s1">        "text": "This is the text of the attachment. It should appear just above an image of the Mattermost logo. The left border of the attachment should be colored orange, and below the image it should include additional fields that are formatted in columns. At the top of the attachment, there should be an author name followed by a bolded title. Both the author name and the title should be hyperlinks.",</span>
<span class="s1">        "author_name": "Mattermost",</span>
<span class="s1">        "author_icon": "https://mattermost.com/wp-content/uploads/2022/02/icon_WS.png",</span>
<span class="s1">        "author_link": "https://mattermost.org/",</span>
<span class="s1">        "title": "Example Attachment",</span>
<span class="s1">        "title_link": "https://developers.mattermost.com/integrate/admin-guide/admin-message-attachments/",</span>
<span class="s1">        "fields": [</span>
<span class="s1">          {</span>
<span class="s1">            "short":false,</span>
<span class="s1">            "title":"Long Field",</span>
<span class="s1">            "value":"Testing with a very long piece of text that will take up the whole width of the table. And then some more text to make it extra long."</span>
<span class="s1">          },</span>
<span class="s1">          {</span>
<span class="s1">            "short":true,</span>
<span class="s1">            "title":"Column One",</span>
<span class="s1">            "value":"Testing"</span>
<span class="s1">          },</span>
<span class="s1">          {</span>
<span class="s1">            "short":true,</span>
<span class="s1">            "title":"Column Two",</span>
<span class="s1">            "value":"Testing"</span>
<span class="s1">          },</span>
<span class="s1">          {</span>
<span class="s1">            "short":false,</span>
<span class="s1">            "title":"Another Field",</span>
<span class="s1">            "value":"Testing"</span>
<span class="s1">          }</span>
<span class="s1">        ],</span>
<span class="s1">        "image_url": "https://mattermost.com/wp-content/uploads/2022/02/icon_WS.png"</span>
<span class="s1">      }</span>
<span class="s1">    ]</span>
<span class="s1">  }'</span> <span class="s2">"</span><span class="nv">$incoming_webhook_url</span><span class="s2">"</span>
</pre></div>
</div>
<p>参考資料:</p>
<ul class="simple">
<li><p>https://developers.mattermost.com/integrate/admin-guide/admin-message-attachments/#example-message-attachment</p></li>
</ul>
</section>
<section id="todo">
<h3>TODO: 画像を添付して書く。<a class="headerlink" href="#todo" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>(要アクセストークン)</p>
<p>参考資料:</p>
<ul class="simple">
<li><p>https://mattermost.com/blog/mattermost-integrations-mattermost-api/</p></li>
<li><p>https://vaelor.github.io/python-mattermost-driver/endpoints.html#module-mattermostdriver.endpoints.files</p></li>
<li><p>https://www.d-make.co.jp/blog/2021/01/28/mattermost-api-%E3%81%A7%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E6%8A%95%E7%A8%BF%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F/</p></li>
</ul>
</section>
<section id="id5">
<h3>TODO: 指定スレッドに返信する。<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
</section>
</section>
<section id="outgoing-webhook">
<h2>Outgoing Webhook<a class="headerlink" href="#outgoing-webhook" title="このヘッドラインへのパーマリンク">¶</a></h2>
<section id="id6">
<h3>Outgoing Webhook を作り、コールバックを実装する。<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>チャンネル <code class="docutils literal notranslate"><span class="pre">channel1</span></code> にキーワード <code class="docutils literal notranslate"><span class="pre">#bot1</span></code> を含むメッセージを書き込んだ時、
Mattermost が <code class="docutils literal notranslate"><span class="pre">http://172.30.101.213:10080/callback</span></code> に要求し、
その応答に従い、ユーザ名 <code class="docutils literal notranslate"><span class="pre">bot1</span></code> として同チャンネルにメッセージを書き込む。</p>
<section id="id7">
<h4>構成<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                <span class="n">Web</span> <span class="n">service</span> <span class="p">(</span><span class="n">port</span><span class="p">:</span><span class="mi">10080</span><span class="p">)</span>
    <span class="n">Computer</span>    <span class="mf">172.30.101.213</span>
    <span class="o">|</span>           <span class="o">|</span>
   <span class="o">-</span><span class="n">o</span><span class="o">-----------</span><span class="n">o</span><span class="o">-----------</span><span class="n">o</span><span class="o">-</span>
                            <span class="o">|</span>
                            <span class="n">Mattermost</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># WSL2</span>
<span class="nv">ipaddr</span><span class="o">=</span><span class="k">$(</span>ip -j a <span class="p">|</span> jq -r <span class="s2">"map(select(.ifname==\"eth0\")) | .[].addr_info | map(select(.family==\"inet\")) | .[].local"</span><span class="k">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$ipaddr</span><span class="s2">"</span>
<span class="nv">port</span><span class="o">=</span><span class="s2">"10080"</span>
<span class="nv">url</span><span class="o">=</span><span class="s2">"http://</span><span class="si">${</span><span class="nv">ipaddr</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</div>
</section>
<section id="id8">
<h4>Mattermost 設定<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ul class="simple">
<li><p>System Console</p>
<ul>
<li><p>Environment</p>
<ul>
<li><p>Developer</p>
<ul>
<li><p>DeveloperSettings</p>
<ul>
<li><p>Allow untrusted internal connections to: <code class="docutils literal notranslate"><span class="pre">172.30.101.213</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Integrations</p>
<ul>
<li><p>Outgoing Webhooks</p>
<ul>
<li><p>Title: outgoing-webhook1</p></li>
<li><p>Description:</p></li>
<li><p>Content-Type: application/json</p></li>
<li><p>Channel: <code class="docutils literal notranslate"><span class="pre">channel1</span></code></p></li>
<li><p>Trigger Words (One Per Line): <code class="docutils literal notranslate"><span class="pre">#bot1</span></code></p></li>
<li><p>Callback URLs (One Per Line): <code class="docutils literal notranslate"><span class="pre">http://172.30.101.213:10080/callback</span></code></p></li>
<li><p>Username: <code class="docutils literal notranslate"><span class="pre">bot1</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>トークンが生成される。
このトークンを Web service 側で検証することで、どの Webhook かサービス側で特定できる。
今回は使わない。</p>
</section>
<section id="web-service">
<h4>Web service 設定<a class="headerlink" href="#web-service" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls
<span class="go">app.py  poetry.lock  pyproject.toml</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/callback'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">callback</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">])</span>
    <span class="k">return</span> <span class="s1">'{"text": "hello"}'</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'0.0.0.0'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">10080</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat pyproject.toml
<span class="go">[tool.poetry]</span>
<span class="go">name = "mattermost-bot"</span>
<span class="go">version = "0.1.0"</span>
<span class="go">description = ""</span>
<span class="go">authors = ["Your Name &lt;you@example.com&gt;"]</span>

<span class="go">[tool.poetry.dependencies]</span>
<span class="go">python = "^3.8"</span>
<span class="go">Flask = "^2.2.1"</span>
<span class="go">requests = "^2.28.1"</span>

<span class="go">[tool.poetry.dev-dependencies]</span>

<span class="go">[build-system]</span>
<span class="go">requires = ["poetry-core&gt;=1.0.0"]</span>
<span class="go">build-backend = "poetry.core.masonry.api"</span>
<span class="gp">$</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python app.py
<span class="go">WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.</span>
<span class="go"> * Serving Flask app 'app'</span>
<span class="go"> * Debug mode: on</span>
<span class="go"> * Running on all addresses (0.0.0.0)</span>
<span class="go">   WARNING: This is a development server. Do not use it in a production deployment.</span>
<span class="go"> * Running on http://127.0.0.1:10080</span>
<span class="go"> * Running on http://172.30.101.213:10080 (Press CTRL+C to quit)</span>
<span class="go"> * Restarting with stat</span>
<span class="go"> * Debugger is active!</span>
<span class="go"> * Debugger PIN: 130-808-904</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="slash-commands">
<h2>Slash commands<a class="headerlink" href="#slash-commands" title="このヘッドラインへのパーマリンク">¶</a></h2>
<section id="slash-command">
<h3>Slash command を作り、コールバックを実装する。<a class="headerlink" href="#slash-command" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>チャンネル <code class="docutils literal notranslate"><span class="pre">channel1</span></code> に <code class="docutils literal notranslate"><span class="pre">/hello</span></code> を含むメッセージを書き込んだ時、
Mattermost が <code class="docutils literal notranslate"><span class="pre">http://172.30.101.213:20080/callback</span></code> に要求し、
その応答に従い、ユーザ名 <code class="docutils literal notranslate"><span class="pre">bot2</span></code> として同チャンネルの元投稿者にのみ見えるメッセージを書き込む。</p>
<section id="id9">
<h4>構成<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                <span class="n">Web</span> <span class="n">service</span> <span class="p">(</span><span class="n">port</span><span class="p">:</span><span class="mi">20080</span><span class="p">)</span>
    <span class="n">Computer</span>    <span class="mf">172.30.101.213</span>
    <span class="o">|</span>           <span class="o">|</span>
   <span class="o">-</span><span class="n">o</span><span class="o">-----------</span><span class="n">o</span><span class="o">-----------</span><span class="n">o</span><span class="o">-</span>
                            <span class="o">|</span>
                            <span class="n">Mattermost</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># WSL2</span>
<span class="nv">ipaddr</span><span class="o">=</span><span class="k">$(</span>ip -j a <span class="p">|</span> jq -r <span class="s2">"map(select(.ifname==\"eth0\")) | .[].addr_info | map(select(.family==\"inet\")) | .[].local"</span><span class="k">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$ipaddr</span><span class="s2">"</span>
<span class="nv">port</span><span class="o">=</span><span class="s2">"20080"</span>
<span class="nv">url</span><span class="o">=</span><span class="s2">"http://</span><span class="si">${</span><span class="nv">ipaddr</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</div>
</section>
<section id="id10">
<h4>Mattermost 設定<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ul class="simple">
<li><p>System Console</p>
<ul>
<li><p>Environment</p>
<ul>
<li><p>Developer</p>
<ul>
<li><p>DeveloperSettings</p>
<ul>
<li><p>Allow untrusted internal connections to: <code class="docutils literal notranslate"><span class="pre">172.30.101.213</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Integrations</p>
<ul>
<li><p>Slash commands</p>
<ul>
<li><p>Title: slash-command1</p></li>
<li><p>Description:</p></li>
<li><p>Command Trigger Word: <code class="docutils literal notranslate"><span class="pre">hello</span></code></p></li>
<li><p>Request URL: <code class="docutils literal notranslate"><span class="pre">http://172.30.101.213:20080/callback</span></code></p></li>
<li><p>Request Method: <code class="docutils literal notranslate"><span class="pre">POST</span></code></p></li>
<li><p>Response Username: <code class="docutils literal notranslate"><span class="pre">bot2</span></code></p></li>
<li><p>[ ] Autocomplete</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>トークンが生成される。
このトークンを Web service 側で検証することで、どの Slash command かサービス側で特定できる。
今回は使わない。</p>
</section>
<section id="id11">
<h4>Web service 設定<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls
<span class="go">app.py  poetry.lock  pyproject.toml</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>$ cat app.py
from flask import Flask, request


app = Flask(__name__)


@app.route('/callback', methods=['POST', 'GET'])
def callback():
    print(request.form)
    return '{"text": "hello"}'


if __name__ == '__main__':
    app.debug = True
    app.run(host='0.0.0.0', port=20080)
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat pyproject.toml
<span class="go">[tool.poetry]</span>
<span class="go">name = "mattermost-slash-command"</span>
<span class="go">version = "0.1.0"</span>
<span class="go">description = ""</span>
<span class="go">authors = ["Your Name &lt;you@example.com&gt;"]</span>

<span class="go">[tool.poetry.dependencies]</span>
<span class="go">python = "^3.8"</span>
<span class="go">Flask = "^2.2.1"</span>
<span class="go">requests = "^2.28.1"</span>

<span class="go">[tool.poetry.dev-dependencies]</span>

<span class="go">[build-system]</span>
<span class="go">requires = ["poetry-core&gt;=1.0.0"]</span>
<span class="go">build-backend = "poetry.core.masonry.api"</span>
<span class="gp">$</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="html.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">HTML</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="gitlab.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">GitLab</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, kumarstack55 |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>. |
            <a class="muted-link" href="_sources/mattermost.md.txt"
               rel="nofollow">
              ソースコードを表示
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            コンテンツ
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Mattermost</a><ul>
<li><a class="reference internal" href="#id1">Mattermost をインストールする。</a></li>
<li><a class="reference internal" href="#incoming-webhook">Incoming Webhook</a><ul>
<li><a class="reference internal" href="#incoming-webhook-url">Incoming Webhook の URL を作る。</a></li>
<li><a class="reference internal" href="#id2">指定チャネルに書く。</a></li>
<li><a class="reference internal" href="#id3">ユーザ名を指定して指定チャネルに書く。</a></li>
<li><a class="reference internal" href="#id4">アタッチメントを書く。</a></li>
<li><a class="reference internal" href="#todo">TODO: 画像を添付して書く。</a></li>
<li><a class="reference internal" href="#id5">TODO: 指定スレッドに返信する。</a></li>
</ul>
</li>
<li><a class="reference internal" href="#outgoing-webhook">Outgoing Webhook</a><ul>
<li><a class="reference internal" href="#id6">Outgoing Webhook を作り、コールバックを実装する。</a><ul>
<li><a class="reference internal" href="#id7">構成</a></li>
<li><a class="reference internal" href="#id8">Mattermost 設定</a></li>
<li><a class="reference internal" href="#web-service">Web service 設定</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#slash-commands">Slash commands</a><ul>
<li><a class="reference internal" href="#slash-command">Slash command を作り、コールバックを実装する。</a><ul>
<li><a class="reference internal" href="#id9">構成</a></li>
<li><a class="reference internal" href="#id10">Mattermost 設定</a></li>
<li><a class="reference internal" href="#id11">Web service 設定</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/main.js"></script>
    <script src="_static/translations.js"></script>
    </body>
</html>