# Microsoft Windows

## LISTEN しているポートを得る。

```powershell
netstat -anp TCP
```

## 指定コマンドのパスを得る。

```console
PS tmp> where.exe ssh.exe
C:\Windows\System32\OpenSSH\ssh.exe
```

## BCDEDIT - ブート構成データ ストア エディター

### ストアのエントリを一覧表示する。

```
# cmd.exe
bcdedit.exe /enum
```

```
C:\WINDOWS\system32>bcdedit.exe /enum

Windows ブート マネージャー
--------------------------------
identifier              {bootmgr}
device                  partition=\Device\HarddiskVolume1
path                    \EFI\Microsoft\Boot\bootmgfw.efi
description             Windows Boot Manager
locale                  ja-JP
inherit                 {globalsettings}
isolatedcontext         Yes
default                 {current}
resumeobject            {198fde25-3998-11ec-8825-502f9b7dcde5}
displayorder            {current}
toolsdisplayorder       {memdiag}
timeout                 30

Windows ブート ローダー
--------------------------------
identifier              {current}
device                  partition=C:
path                    \WINDOWS\system32\winload.efi
description             Windows 11
locale                  ja-JP
inherit                 {bootloadersettings}
recoverysequence        {198fde28-3998-11ec-8825-502f9b7dcde5}
displaymessageoverride  Recovery
recoveryenabled         Yes
isolatedcontext         Yes
allowedinmemorysettings 0x15000075
osdevice                partition=C:
systemroot              \WINDOWS
resumeobject            {198fde25-3998-11ec-8825-502f9b7dcde5}
nx                      OptIn
bootmenupolicy          Standard
hypervisorlaunchtype    Auto
```

### 参考: bcdedit /?

```console
>bcdedit /?

BCDEDIT - ブート構成データ ストア エディター

Bcdedit.exe コマンドライン ツールは、ブート構成データ ストアを修正します。
ブート構成データ ストアにはブート構成パラメーターが含まれ、オペレーティング
システムのブート方法を制御します。これらのパラメーターは、以前は Boot.ini
ファイル (BIOS ベースのオペレーティング システム内) か、不揮発性 RAM エントリ
(拡張ファームウェア インターフェイスベースのオペレーティング システム内) に
ありました。Bcdedit.exe を使用して、ブート構成データ ストアのエントリを追加、
削除、編集、および付加することができます。

詳細なコマンドとオプション情報については、「bcdedit.exe /? <command>」と入力
してください。たとえば、/createstore コマンドについて詳細情報を表示するには以下のように入力します。

     bcdedit.exe /? /createstore

ヘルプ ファイルのトピック順の一覧を参照するには、"bcdedit /? TOPICS" を実行します。

ストアの操作のコマンド
======================
/store          現在のシステムの既定以外の BCD ストアを指定するために使用されます。
/createstore    新しい空のブート構成データ ストアを作成します。
/export         システム ストアの内容をファイルにエクスポートします。
                このファイルは、システム ストアの状態を復元するために後から使用することができます。
/import         /export コマンドで作成されたバックアップ ファイルを使用して、
                システム ストアの状態を復元します。
/sysstore       システム ストア デバイスを設定します (EFI システムにのみ有効
                です。設定内容は再起動後まで維持されません。システム ストア
                デバイスが明確に指定されていない場合にのみ使用されます)。

ストア内のエントリの操作のコマンド
==================================
/copy           ストアにエントリのコピーを作成します。
/create         ストアに新しいエントリを作成します。
/delete         ストアからエントリを削除します。
/mirror         ストアにエントリのミラーを作成します。

これらのコマンドで使用する ID の情報については bcdedit /? ID を実行してください。

エントリ オプションの操作のコマンド
===================================
/deletevalue    ストアからエントリ オプションを削除します。
/set            ストアにエントリ オプションの値を設定します。

これらのコマンドで使用するデータの種類の一覧については bcdedit /? TYPES を実行してください。
有効なデータ形式の一覧については bcdedit /? FORMATS を実行してください。

出力を制御するコマンド
======================
/enum           ストアのエントリを一覧表示します。
/v              既知の識別子名を使用するのではなく、エントリ識別子を完全な
                形式で表示するコマンドライン オプションです。
                ACTIVE な種類のエントリ識別子の完全な形式を表示するコマンド
                として /v を使用します。

"bcdedit" の実行は "bcdedit /enum ACTIVE" の実行と同じです。

ブート マネージャーを制御するコマンド
===================================
/bootsequence   ブート マネージャーの 1 回限りのブート シーケンスを設定します。
/default        ブート マネージャーが使用する既定のエントリを設定します。
/displayorder   ブート マネージャーがマルチブート メニューを表示する順序を設定
                します。
/timeout        ブート マネージャーのタイムアウト値を設定します。
/toolsdisplayorder  ブート マネージャーがツール メニューを表示する順序を設定
                    します。

ブート アプリケーションの緊急管理サービスを制御するコマンド
===========================================================
/bootems        ブート アプリケーションの緊急管理サービスを有効または無効に
                します。
/ems            オペレーティング システム エントリの緊急管理サービスを有効
                または無効にします。
/emssettings    グローバルな緊急管理サービスのパラメーターを設定します。

デバッグを制御するコマンド
==========================
/bootdebug      ブート アプリケーションのブート デバッグを有効または無効にします。
/dbgsettings    グローバル デバッガー パラメーターを設定します。
/debug          オペレーティング システム エントリのカーネル デバッグを有効
                または無効にします。
/hypervisorsettings  ハイパーバイザー パラメーターを設定します。

リモート イベント ログを制御するコマンド
=========================================
/eventsettings  グローバルなリモート イベント ログ パラメーターを設定します。
/event          オペレーティング システム エントリのリモート イベント ログを
                有効または無効にします。
```

## WSL2

https://docs.microsoft.com/en-us/windows/wsl/install

### WSLのステータスを得る。

```powershell
wsl --status
```

### ディストリビューションの一覧を得る。

```powershell
wsl -l -o
```

### ローカルのディストリビューションの一覧を得る。

```powershell
wsl -l -v
```

### ディストリビューションをインストールし、State を Running にする。

```powershell
wsl --install -d Ubuntu
```

### インストールしたディストリビューションを消す。

```powershell
wsl --unregister Ubuntu
```

### 既存ウィンドウでシェルを起動し、 State を Running にする。

```powershell
wsl
# または
wsl ~
```

### 指定コマンドを実行し、 State を Running にする。

```powershell
wsl --exec uname
# または
wsl uname
```

### ディストリビューションを指定する。

```powershell
wsl -d Ubuntu-20.04
```

### すべてのディストリビューションの State を Stopped にする。

```powershell
wsl --shutdown
```

### ネットワーク構成

```
    |
   -o-o-
      |
      vEthernet (WSL)
      ip address: 172.19.64.1
      |
     -o-o- 172.19.64.0/20
        |
        eth0
        Ubuntu
        nameserver: 172.19.64.1
```

### 参考: wsl --help

```console
PS > wsl --status
既定のバージョン: 2

Linux 用 Windows サブシステムの最終更新日: 2021/12/05
Windows Subsystem for Linux カーネルは、'wsl --update' を使用して手動で更新できますが、システム設定が原因で自動更新が発生することはありません。
カーネルの自動更新を受け取るには、 Windows Update の設定を有効にしてください:' Windowsの更新に、その他のMicrosoftの製品の更新情報を受け取る'。
詳細については、 https://aka.ms/wsl2kernel.
 を参照してください
カーネル バージョン: 5.10.60.1
```

```console
PS > wsl --help
Copyright (c) Microsoft Corporation. All rights reserved.

使用法: wsl.exe [Argument] [Options...] [CommandLine]

Linux バイナリを実行するための引数:

    コマンドラインを指定しない場合、wsl.exe によって既定のシェルが起動されます。

    --exec, -e <CommandLine>
        既定の Linux シェルを使用せずに、指定したコマンドを実行します。

    --
        残りのコマンドラインをそのまま渡します。

オプション:
    --cd <Directory>
        指定したディレクトリを現在の作業ディレクトリとして設定します。
        ~ が使用されている場合は、Linux ユーザーのホーム パスが使用されます。パスの先頭が
        / の場合は、Linux の絶対パスと解釈されます。
        それ以外の場合、この値は Windows の絶対パスである必要があります。

   --distribution, -d <Distro>
        指定したディストリビューションを実行します。

   --user, -u <UserName>
        指定されたユーザーとして実行します。

     --system
        システム配布用のシェルを起動します。

Windows Subsystem for Linux を管理するための引数:

    --help
        使用状況に関する情報を表示します。

    --install [Options]
      追加の Windows Subsystem for Linux ディストリビューションをインストールします。
      有効なディストリビューションの一覧を表示するには、'wsl--list--online' を使用してください。

        オプション:
            --distribution, -d [Argument]
                名前を指定して配布をダウンロードしてインストールします。

                引数:
                   有効なディストリビューション名 (大文字と小文字は区別されません)。

                例:
                    wsl --install -d Ubuntu
                    wsl --install --distribution Debian

    --set-default-version <Version>
         新しいディストリビューションの既定のインストールバージョンを変更します。

    --shutdown
        直ちに、すべての実行中の配布および WSL 2
 軽快なユーティリティの仮想マシンを終了します。

    --status
        Linux の Windows Subsystem の状態を示します。

    --update [Options]
        オプションが指定されていない場合、WSL 2 カーネルは更新され
 、最新バージョンになります。

        オプション:
            --rollback
                以前のバージョンの WSL 2 カーネルに戻します。

Windows Subsystem for Linuxのディストリビューションを管理するための引数:

    --export <Distro> <FileName>
        ディストリビューションを tar ファイルにエクスポートします。
ファイル名には、標準出力として - を使用できます。

    --import <Distro> <InstallLocation> <FileName> [Options]
        指定した tar ファイルを新しいディストリビューションとしてインポートします。
ファイル名には標準入力として - を使用できます。

        オプション:
            --version <Version>
                新しいディストリビューションに使用するバージョンを指定します。

    --list, -l [Options]
        ディストリビューションの一覧を表示します。

        オプション:
            --all
                現在インストールまたはアンインストールされているディストリビューションを含む、すべてのディストリビューションを表示します。

            --running
                現在実行中のディストリビューションのみを表示します。

            --quiet, -q
                ディストリビューション名のみを表示します。

            --verbose, -v
                すべてのディストリビューションに関する詳細な情報を表示します。

            --online, -o
                'wsl --install' を使用してインストールするために使用できるディストリビューションの一覧を表示します。

    --set-default, -s <Distro>
       ディストリビューションを既定として設定します。

    --set-version <Distro> <Version>
        指定されたディストリビューションのバージョンを変更します。

    --terminate, -t <Distro>
        指定されたディストリビューションを終了します。

    --unregister <Distro>
        ディストリビューションの登録を解除し、ルートファイルシステムを削除します。

    --mount <Disk>
        すべての WSL2 配布に物理ディスクをアタッチしてマウントします。

        オプション:
            --bare
                ディスクを WSL2 に接続しますが、マウントしません。

            --type <Type>
                ディスクのマウント時に使用するファイルシステムです。指定しない場合は、既定で ext4 になります。

            --options <Options>
                追加のマウントオプション。

            --partition <Index>
                マウントするパーティションのインデックスです。指定しない場合、既定でディスク全体が指定されます。

    --unmount [Disk]
        すべての WSL2 ディストリビューションからディスクのマウントを解除してデタッチします。
        引数なしで呼び出された場合は、ディスクをマウント解除してデタッチします。
```
